<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#000000">
    <script src="../resources/js/jquery-3.5.1.min.js"></script>
    <script src="../resources/js/report.js"></script>
    <script src="../resources/js/laydate.js"></script>
    <script src="../resources/js/jquery.table2excel.js"></script>
    <title>天乐湖 | 后台管理</title>
    <style>
        #ietips {
            position: fixed;
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            line-height: 40px;
            display: none;
            text-align: center;
            z-index: 1000;
        }
        .layui-btn {
            height: 38px;
            line-height: 38px;
            border: 1px solid transparent;
            padding: 0 18px;
            background-color: #009688;
            color: #fff;
            white-space: nowrap;
            text-align: center;
            font-size: 14px;
            border-radius: 2px;
            cursor: pointer
        }
    </style>
    <link href="../resources/css/vendor.css" rel="stylesheet">
    <link href="../resources/css/interns.css" rel="stylesheet">
    <link href="../resources/css/layui.css" rel="stylesheet">
    <style data-styled="" data-styled-version="4.0.2"></style>
</head>
<body onload="empMultiple(true)">
<div id="ietips">IE浏览器版本过低，可能影响使用，建议升级浏览器，或者下载其他浏览器来打开本网站。</div>
<noscript>
    You need to enable JavaScript to run this app.
</noscript>
<div id="root">
    <div class="layout" style="min-height: 949px;">
        <div class="headerPlaceholder"></div>
        <div class="common-header fixed" style="background-color: rgb(255, 255, 255); color: rgba(34, 34, 34, 0.65);">
            <div class="logo-wrap">
                <img src="../resources/images/logo.png" alt="" class="logo">
            </div>

            <ul class="navbar">
                <li class="nav-item " style=""><a href="../passengerflow.html">首页</a></li>
                <li class="nav-item active" style="border-color: rgb(0, 0, 0); color: rgb(34, 34, 34);"><a
                        href="./empreport.html">人员报表</a></li>
                <li class="nav-item " style=""><a
                        href="scenicreport.html">景点报表</a></li>
                <li class="nav-item  "><a
                        href="hrmanage.html">职工管理</a></li>
                <li class="nav-item  "><a
                        href="ticketreport.html">票务记录</a></li>
            </ul>
            <div class="right-nav">
                <div class="login-btn-wrap" style="display: block;"><span class="reg-btn"
                                                                          style="background-color: rgb(0, 0, 0); color: rgb(255, 255, 255);">注册</span><span
                        class="login-btn" style="background-color: rgb(0, 0, 0); color: rgb(255, 255, 255);">登录</span>
                </div>
            </div>
        </div>
        <div class="content-wrap">
            <div class="slick-slider social-banner slick-initialized">
                <div class="slick-list">
                    <div class="slick-track" style="width: 100%; opacity: 1; transform: translate3d(0px, 0px, 0px);">
                        <div data-index="0" class="slick-slide slick-active slick-current" tabindex="-1"
                             aria-hidden="false" style="outline: none; width: 100%;">
                            <div>
                                <div class="banner-item" tabindex="-1" style="width: 100%; display: inline-block;">
                                    <img src="../resources/images/header.jpg" style="width: 100%">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="social-contents">
                <div class="hor-nav">
                    <div class="serach-bar" style="display: block;width: 300px">
                        <div class="hor-nav-tit"><span>36</span>&nbsp;条记录</div>
                        <div class="hor-nav-item">
                            <button type="button" class="layui-btn " onclick="gotoDownload()">导出</button><span class="search-btn">
                            <i aria-label="图标: search" class="anticon anticon-search"
                                style="font-size: 18px; color: rgb(0, 0, 0);"></i></span>
                        </div>
                    </div>
                    <div class="categories">
                        <div class="category">
                            <div class="hor-nav-tit"><span>员工接待</span><i aria-label="图标: right"
                                                                         class="anticon anticon-right">
                                <svg viewBox="64 64 896 896" class="" data-icon="right" width="1em" height="1em"
                                     fill="currentColor" aria-hidden="true" focusable="false">
                                    <path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path>
                                </svg>
                            </i></div>
                            <ul class="hor-nav-item-wrap" style="padding-right: 0.7rem; height: 0.24rem;">
                                <li class="hor-nav-item" id="empDaily" onclick="empMultiple(true)">今日数据</li>
                                <li class="hor-nav-item" id="empDays" onclick="empMultiple(false)">累计数据</li>
                                <li class="hor-nav-item" id="singleEmp" onclick="empSingle()">单人数据</li>
                            </ul>
                        </div>
                        <div class="category" id="dateCondition" style="height: 45px">
                            <div class="hor-nav-tit"><span>起止日期</span><i aria-label="图标: right"
                                                                         class="anticon anticon-right">
                                <svg viewBox="64 64 896 896" class="" data-icon="right" width="1em" height="1em"
                                     fill="currentColor" aria-hidden="true" focusable="false">
                                    <path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path>
                                </svg>
                            </i></div>
                            <input type="text" class="date" id="layDate-start" placeholder="起始日期"
                                   style="border: 1px solid #e2e2e2;margin-right: 20px;text-align: center">
                            <label style="line-height: 45px">-</label>
                            <input type="text" class="date" id="layDate-end" placeholder="截止日期"
                                   style="border: 1px solid #e2e2e2;margin-left: 20px;text-align: center;">
                            <button type="button" class="layui-btn  " onclick="empMultiple()" style="margin-top: 4px;margin-left: 20px; background-color: #ffffff; background-image:url(../resources/images/searchme.png) ;background-size:100% 100%"></button>
                        </div>
                        <div class="category" id="employeeCondition" style="height: 45px">
                            <div class="hor-nav-tit"><span >输入员工</span><i aria-label="图标: search"
                                                                         class="anticon anticon-right">
                                <svg viewBox="64 64 896 896" class="" data-icon="right" width="1em" height="1em"
                                     fill="currentColor" aria-hidden="true" focusable="false">
                                    <path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path>
                                </svg>
                            </i></div>
                            <div class="hor-nav-item">
                                    <input val="" class="search-ipt" type="text" placeholder="检索员工" list="namelist" style="">
                                    <datalist id="namelist"></datalist>
                                    <span class="search-btn">

                                    <button type="button" class="layui-btn" onclick="empSingle()" style="display: inline-block;margin-left: 20px; background-color: #ffffff; background-image:url(../resources/images/searchme.png) ;background-size:100% 100%"></button>
                                    </span>
                                </div>
                        </div>
                    </div>
                </div>
                <div class="position-list-wrap">
                    <div class="ant-spin-nested-loading">
                        <div class="ant-spin-container">
                            <div class="list-wrap" style="width: 84%; margin-top: 80px;">
                                <div class="list-box">
                                    <div class="list-hd list-row-item">
                                        <div class="list-cell pos-name" title="日期" style="width: auto; flex: 1 1 0%;">
                                            日期
                                        </div>
                                        <div class="list-cell pos-name" title="员工姓名" style="width: auto; flex: 1 1 0%;">
                                            员工姓名
                                        </div>
                                        <div class="list-cell pos-cate" title="ID" style="width: auto; flex: 1 1 0%;">
                                            ID
                                        </div>
                                        <div class="list-cell pos-cate" title="位置" style="width: auto; flex: 1 1 0%;">
                                            位置
                                        </div>
                                        <div class="list-cell pos-workType" title="累计值"
                                             style="width: auto; flex: 1 1 0%;">
                                            累计值
                                        </div>
                                        <div class="list-cell pos-pubTime" title="一星获得"
                                             style="width: auto; flex: 1 1 0%;">
                                            一星获得
                                        </div>
                                        <div class="list-cell pos-workPlace" title="二星获得"
                                             style="width: auto; flex: 1 1 0%;">
                                            二星获得
                                        </div>
                                        <div class="list-cell pos-workPlace" title="三星获得"
                                             style="width: auto; flex: 1 1 0%;">
                                            三星获得
                                        </div>
                                        <div class="list-cell pos-workPlace" title="四星获得"
                                             style="width: auto; flex: 1 1 0%;">
                                            四星获得
                                        </div>
                                        <div class="list-cell pos-workPlace" title="五星获得"
                                             style="width: auto; flex: 1 1 0%;">
                                            五星获得
                                        </div>
                                    </div>


                                </div>
                                <div class="sc-bwzfXH iqNRXT">
                                    <ul class="ant-pagination" unselectable="unselectable">
                                        <li title="上一页" class="ant-pagination-disabled ant-pagination-prev"
                                            aria-disabled="true">
                                            <a class="ant-pagination-item-link">
                                                <i aria-label="图标: left" class="anticon anticon-left">
                                                    <svg viewBox="64 64 896 896" class="" data-icon="left" width="1em"
                                                         height="1em" fill="currentColor" aria-hidden="true"
                                                         focusable="false">
                                                        <path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path>
                                                    </svg>
                                                </i></a></li>
                                        <li title="1"
                                            class="ant-pagination-item ant-pagination-item-1 ant-pagination-item-active"
                                            tabindex="0"><a>1</a></li>
                                        <li title="2" class="ant-pagination-item ant-pagination-item-2" tabindex="0"><a>2</a>
                                        </li>
                                        <li title="3" class="ant-pagination-item ant-pagination-item-3" tabindex="0"><a>3</a>
                                        </li>
                                        <li title="下一页" tabindex="0" class=" ant-pagination-next" aria-disabled="false">
                                            <a class="ant-pagination-item-link"><i aria-label="图标: right"
                                                                                   class="anticon anticon-right">
                                                <svg viewBox="64 64 896 896" class="" data-icon="right" width="1em"
                                                     height="1em" fill="currentColor" aria-hidden="true"
                                                     focusable="false">
                                                    <path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path>
                                                </svg>
                                            </i></a></li>
                                        <li class="ant-pagination-options">
                                            <div class="ant-pagination-options-quick-jumper">跳至<input type="text" value="">页
                                              <span><span class="pageButton" style="background-color: rgb(0, 0, 0); border-radius: 0px;">确认</span>
                                              </span>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div style="visibility: hidden" class="hid">
    <div class="list-row-item">
        <div class="list-cell pos-name" style="width: auto; flex: 1 1 0%;">
                                            <span class="list-cell-span"
                                                  title="日期"></span>
        </div>
        <div class="list-cell pos-name" style="width: auto; flex: 1 1 0%;">
                                            <span class="list-cell-span"
                                                  title="员工姓名"></span>
        </div>
        <div class="list-cell pos-cate" style="width: auto; flex: 1 1 0%;">
            <span class="list-cell-span" title="ID"></span>
        </div>
        <div class="list-cell pos-cate" style="width: auto; flex: 1 1 0%;">
            <span class="list-cell-span" title="位置"></span>
        </div>
        <div class="list-cell pos-workType" style="width: auto; flex: 1 1 0%;">
            <span class="list-cell-span" title="累计值"></span>
        </div>
        <div class="list-cell pos-pubTime" style="width: auto; flex: 1 1 0%;">
            <span class="list-cell-span" title="一星获得"></span>
        </div>
        <div class="list-cell pos-locate" style="width: auto; flex: 1 1 0%;">
            <span class="list-cell-span" title="二星获得"></span>
        </div>
        <div class="list-cell pos-pubTime" style="width: auto; flex: 1 1 0%;">
            <span class="list-cell-span" title="三星获得"></span>
        </div>
        <div class="list-cell pos-locate" style="width: auto; flex: 1 1 0%;">
            <span class="list-cell-span" title="四星获得" ></span>
        </div>
        <div class="list-cell pos-pubTime" style="width: auto; flex: 1 1 0%;">
            <span class="list-cell-span" title="五星获得"></span>
        </div>
    </div>
</div>
<script>
    let rowOriginal=$('.hid').find('.list-row-item')
    let table = $(".list-box")
    let empSearch=$(".search-ipt")
    let date=getToday()


    empSearch.bind('keypress',function (event){
        if(event.keyCode=="13")empSingle()
    })

    lay('.date').each(function (){
        laydate.render({
            elem: this//指定元素
            ,max:0
            ,value:date
        });
    })
    function empMultiple(isToday){
        $("#employeeCondition").hide()
        $("#dateCondition").show()
        let dateStart,dateEnd
        if(isToday){
            dateStart=dateEnd=date
            makeFocus($("#empDaily"))
            $("#dateCondition").hide()
        }else{
            dateStart=$("#layDate-start").val()
            dateEnd=$("#layDate-end").val()
            makeFocus($("#empDays"))
        }
        $.get(
            "/record/multiple",
            {
                "start":dateStart,
                "end":dateEnd
            },
            function (response){
                if(response.result=="success")
                    fillTable(response.data)

                },
            "json"
        )
    }

    function empSingle(){
        $("#employeeCondition").show()
        $("#dateCondition").hide()
        makeFocus($("#singleEmp"))
        let empInfo=empSearch.val()
        if(empInfo=="") return;
        if(empInfo.split(" ").length<1) return;
        $.get(
            "/record/single",
            {
                "employeeID":empInfo.split(" ")[1],
            },
            function (response){
                if(response.result=="success")
                   fillTable(response.data)

            },
            "json"
        )
    }
    function fillTable(records){
        table.find("[class='list-row-item']").remove()
        $(".serach-bar").find(".hor-nav-tit").find("span").text(records.length)
        for(let record of records){
            let row=rowOriginal.clone()
            let tempDate='--'
            if(record.hasOwnProperty("timeDate"))
                tempDate=record.timeDate
            row.find("[title='日期']").text(tempDate)
            row.find("[title='员工姓名']").text(record.name)
            row.find("[title='ID']").text(record.employeeID)
            row.find("[title='位置']").text(record.scenicName)
            row.find("[title='累计值']").text(record.receptionCount)
            row.find("[title='一星获得']").text(record.oneStarCount)
            row.find("[title='二星获得']").text(record.twoStarCount)
            row.find("[title='三星获得']").text(record.threeStarCount)
            row.find("[title='四星获得']").text(record.fourStarCount)
            row.find("[title='五星获得']").text(record.fiveStarCount)
            table.append(row)
        }
    }
    $(function(){
        $(".search-ipt").on('input propertychange',refreshList())
    })
    function refreshList(){
        $.get(
            "/employee/list",
            {
                "keyword":empSearch.val()
            },
            function (response){
                let empList=$("#namelist")
                if(response.result=="success"){
                    empList.find("option").remove()
                    for(let employee of response.data){
                        empList.append('<option>'+employee.name+' '+employee.employeeID+'</option>')
                    }
                }


            },
            "json"
        )
    }
    function makeFocus(cur){
        cur.parent(".hor-nav-item-wrap").find("li").css("color","#999")
        cur.css("color","#000")
    }
    function gotoDownload(){
        let filename="全员单日报表"+'-'+date
        exportTb(filename)
    }
</script>
<script>
    /* 低版本ie浏览器提示 */
    if (navigator.appVersion.toLowerCase().indexOf("msie") > -1) {
        document.getElementById("ietips").style.display = 'block'
    }

    /* 兼容ie  scrollTo  nodeList的forEach方法*/
    if (!window.scrollTo) {
        window.scrollTo = function (x, y) {
            window.pageXOffset = x;
            window.pageYOffset = y;
        };
    }
    if (!window.scrollBy) {
        window.scrollBy = function (x, y) {
            window.pageXOffset += x;
            window.pageYOffset += y;
        };
    }
    if (!document.body.scrollTo) {
        Element.prototype.scrollTo = function (x, y) {
            this.scrollLeft = x;
            this.scrollTop = y;
        };
    }
    if (!document.body.scrollBy) {
        Element.prototype.scrollBy = function (x, y) {
            this.scrollLeft += x;
            this.scrollTop += y;
        };
    }
    if (window.NodeList && !NodeList.prototype.forEach) {
        NodeList.prototype.forEach = function (callback, thisArg) {
            thisArg = thisArg || window
            for (var i = 0; i < this.length; i++) {
                callback.call(thisArg, this[i], i, this)
            }
        }
    }

</script>
</body>
</html>